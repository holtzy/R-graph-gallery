<!doctype html>
<html lang="en">
  <head>
    <!-- Google Analytics + AdThrive -->

    <!-- AdThrive Head Tag Manual -->
    <script data-no-optimize="1" data-cfasync="false">
      (function (w, d) {
        w.adthrive = w.adthrive || {};
        w.adthrive.cmd = w.adthrive.cmd || [];
        w.adthrive.plugin = "adthrive-ads-manual";
        w.adthrive.host = "ads.adthrive.com";
        var s = d.createElement("script");
        s.async = true;
        s.referrerpolicy = "no-referrer-when-downgrade";
        s.src =
          "https://" +
          w.adthrive.host +
          "/sites/6434363fc11d8059e61106b4/ads.min.js?referrer=" +
          w.encodeURIComponent(w.location.href) +
          "&cb=" +
          (Math.floor(Math.random() * 100) + 1);
        var n = d.getElementsByTagName("script")[0];
        n.parentNode.insertBefore(s, n);
      })(window, document);
    </script>
    <!-- End of AdThrive Head Tag -->

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-79254642-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-79254642-1");
    </script>

    <!-- Google Analytics + OutboundLink + Google Adsense -->

    <meta charset="utf-8" />
    <title>Bubble map with ggplot2 &#8211; the R Graph Gallery</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="This post explains how to build a
bubble map with ggplot2. It takes a list of GPS coordinates and plot
them on top of a map, with size and color mapped to data." />
    <meta
      name="keywords"
      content="R,ggplot2,tidyverse,Example,Data,Dataviz,Datavisualization,Plot,Chart,Graph,Learning,Caveat,Pitfall,Mistake"
    />
    <meta name="author" content="Yan Holtz" />
    <link rel="icon" href="img/logo/R_single_small.png" />

    <!-- Control appearance when shared by social media -->
    <meta property="og:title" content="Bubble map with ggplot2" />
    <meta
      property="og:image"
      content="https://www.r-graph-gallery.com/img/overview_RGG.png"
    />
    <meta property="og:description" content="This post explains how to
build a bubble map with ggplot2. It takes a list of GPS coordinates and
plot them on top of a map, with size and color mapped to data." />
    <meta
      property="og:url"
      content="https://www.r-graph-gallery.com/330-bubble-map-with-ggplot2.html"
    />
    <meta property="og:type" content="website" />

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom fonts for this template -->
    <link
      href="vendor/font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet" />

    <!-- JQUERY -->
    <script src="vendor/jquery/jquery.min.js"></script>
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="1">
    <!-- THIS ALLOWS TO INSERT THE MENU THAT IS STORED IN A MENU.HTML FILE-->
    <nav class="navbar navbar-expand-lg fixed-top" id="mainNav"></nav>
    <script>
      $(function () {
        $("#mainNav").load("html_chunk/menu.html");
      });
    </script>

    <!-- THIS ALLOWS TO INSERT THE MODAL OF THE MENU THAT IS STORED IN A MENU_MODAL.HTML FILE-->
    <div id="modal_menu_insertion"></div>
    <script>
      $(function () {
        $("#modal_menu_insertion").load("html_chunk/menu_modal.html");
      });
    </script>

    <!-- Header = Title in big + social media Icon + quick description -->
    <header class="masthead" style="padding-bottom: 30px">
      <div class="textlanding">
        <center><h1>Bubble map with ggplot2</h1></center>
        <hr class="short_hr" />
        <br />
        <ul class="list-inline social-buttons">
          <li class="list-inline-item">
            <a href="https://twitter.com/R_Graph_Gallery">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://github.com/holtzy">
              <i class="fa fa-github" style="color: white"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.yan-holtz.com">
              <i class="fa fa-home"></i>
            </a>
          </li>
        </ul>
        <center>
          <p style="max-width: 600px; margin-top: 40px">This post
explains how to build a <a href="bubble-map.html">bubble map</a> with <a
href="ggplot2-package.html">ggplot2</a>. It takes a list of GPS
coordinates and plot them on top of a map, with size and color mapped to
data.</p>
        </center>
        <div style="text-align: center">
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="bubble-map.html"
            >Bubble map section</a
          >
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="https://www.data-to-viz.com/graph/bubblemap.html"
            >About Maps</a
          >
        </div>
      </div>
    </header>

    <!-- THIS ALLOWS TO INSERT THE ADVERTISEMENT BANNER THAT IS STORED IN A BANNER.HTML FILE-->
    <div id="position_for_images"></div>
    <script>
      $(function () {
        $("#position_for_images").load("html_chunk/images.html");
      });
    </script>

    
    <!-- STYLE for chart pages but not the rest of tthe website -->
    <style>
      img {
        margin-top: 20px;
      }
    </style>

    <div class="container" style="padding-top: 100px">
<div class="row">
<div class="col-md-6 col-sm-12 align-self-center">
<p><img src="img/graph/330-bubble-map-with-ggplot2.png" alt="bubble map with R and ggplot2" width="100%"></img></p>
</div>
<div class="col-md-6 col-sm-12 align-self-center">
<p>This post explains how to make a <a href="bubble-map.html">bubble
map</a> with <a href="ggplot2-package.html">ggplot2</a>.</p>
<p>A bubble map is like a <a href="bubble-chart.html">bubble chart</a>,
but with a map in the background. As input you need:</p>
<ul>
<li>a list of GPS coordinates (longitude and latitude of the places you
want to represent)</li>
<li>a numeric variable used for bubble color and size</li>
</ul>
<p>This post provides a step-by-step approach to build the map beside,
showing the 1000 biggest cities of the UK.</p>
<div id="load-data" class="section level1">
<h1>Load data</h1>
<hr />
<p>The first step is to get the boundaries of the zone that interests
you. Several option are available in R, as extensively described in the
<a href="map.html">background map</a> section of the gallery.</p>
<p>Briefly, you can find this information somewhere under the <a
href="168-load-a-shape-file-into-r.html">shapefile</a> format or under
the <a
href="325-background-map-from-geojson-format-in-r.html">geoJSON</a>
format. You can also load google like backgrounds with the <a
href="324-map-background-with-the-ggmap-library.html">ggmap</a>
library.</p>
<p>This post uses the last approach: it loads the <code>maps</code>
package that provides the boundaries of every world country.</p>
</div>
</div>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a> </span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Get the world polygon and extract UK</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>UK <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region<span class="sc">==</span><span class="st">&quot;UK&quot;</span>)</span></code></pre></div>
<p><br></p>
<p>The second step is to load a data frame with the info of the bubble
you want to draw. The <code>maps</code> library provides a list of the
biggest cities in the world. Letâ€™s use it to get information on the
UK.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Get a data frame with longitude, latitude, and size of bubbles (a bubble = a city)</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> world.cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country.etc<span class="sc">==</span><span class="st">&quot;UK&quot;</span>)</span></code></pre></div>
<div id="scatter" class="section level1">
<h1>Basic scatterplot map</h1>
<hr />
<p><code>ggplot2</code> makes it a breeze to map both information on the
same graph. Use <code>geom_polygon</code> for the shape of UK first, and
add your scatterplot on it with <code>geom_point()</code>.</p>
<p>On the right figure, note the use of the <code>ggrepel</code> library
to avoid overlapping between city names.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Left chart</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat)) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a> </span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Second graphic with names of the 10 biggest cities</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">alpha=</span>pop)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>( <span class="at">data=</span>data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">10</span>), <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">label=</span>name), <span class="at">size=</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">10</span>), <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat), <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode-1.png" width="50%" /><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode-2.png" width="50%" /></p>
</div>
<div id="bubble" class="section level1">
<h1>Basic bubble map</h1>
<hr />
<p>Now we want to add another information. The number of inhabitant per
city will be mapped to the colour and the size of the bubbles. Note that
the order of city matters! It is advised to show the most important
information on top (center). This can been done sorting your dataset
before making the plot.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Left: use size and color</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() </span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a> </span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># Center: reorder your dataset first! Big cities appear later = on top</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a> <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span> </span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a> <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop), <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a> </span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co"># Right: just use arrange(desc(pop)) instead</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a> <span class="fu">arrange</span>(<span class="fu">desc</span>(pop)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a> <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop), <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode5-1.png" width="33%" /><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode5-2.png" width="33%" /><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode5-3.png" width="33%" /></p>
</div>
<div id="custom" class="section level1">
<h1>Customized bubble map</h1>
<hr />
<div class="row">
<div class="col-md-6 col-sm-12 align-self-center">
<p><img src="img/graph/330-bubble-map-with-ggplot2.png" alt="bubble map with R and ggplot2" width="100%"></img></p>
</div>
<div class="col-md-6 col-sm-12 align-self-center">
<p>We can custom a little bit this figure for a better looking result
(first image of this post).</p>
<p>Note that here the legend shows both the size, the color and the
transparency on the same circles. This is possible only if these 3
informations are redondante, with the same name, transformation and
breaks.</p>
</div>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Create breaks for the color scale</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>mybreaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.04</span>, <span class="fl">0.08</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># Reorder data to show biggest cities on top</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop=</span>pop<span class="sc">/</span><span class="dv">1000000</span>) </span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co"># Build the map</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    <span class="fu">geom_point</span>(  <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop, <span class="at">alpha=</span>pop), <span class="at">shape=</span><span class="dv">20</span>, <span class="at">stroke=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">name=</span><span class="st">&quot;Population (in M)&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>), <span class="at">breaks=</span>mybreaks) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="fu">scale_alpha_continuous</span>(<span class="at">name=</span><span class="st">&quot;Population (in M)&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="fl">0.1</span>, .<span class="dv">9</span>), <span class="at">breaks=</span>mybreaks) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">option=</span><span class="st">&quot;magma&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span>, <span class="at">breaks=</span>mybreaks, <span class="at">name=</span><span class="st">&quot;Population (in M)&quot;</span> ) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span> </span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>    <span class="fu">guides</span>( <span class="at">colour =</span> <span class="fu">guide_legend</span>()) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;The 1000 biggest cities in the UK&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>      <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.8</span>),</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>),</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">16</span>, <span class="at">hjust=</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<div id="interactive" class="section level1">
<h1>Interactive bubble map with plotly</h1>
<hr />
<div class="row">
<div class="col-md-8 col-sm-12 align-self-center">
<center>
<iframe src="HtmlWidget/bubblemapUK.html" width="100%" height="600px" style="border:none">
</iframe>
</center>
</div>
<div class="col-md-4 col-sm-12 align-self-center">
<p>Last but not least, plotly allows to quickly get an interactive
version. This is really handy since it allows to zoom on the map and
hover a city to know its name and population!</p>
</div>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Load the plotly package</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a> </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Rorder data + Add a new column with tooltip text</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">mytext=</span><span class="fu">paste</span>(</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    <span class="st">&quot;City: &quot;</span>, name, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="st">&quot;Population: &quot;</span>, pop, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  )</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a> </span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co"># Make the map (static)</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>p <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop, <span class="at">text=</span>mytext, <span class="at">alpha=</span>pop) ) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">option=</span><span class="st">&quot;inferno&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span> ) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>    <span class="fu">scale_alpha_continuous</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>    <span class="fu">coord_map</span>() <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a> </span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplotly</span>(p, <span class="at">tooltip=</span><span class="st">&quot;text&quot;</span>)</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>p</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co"># save the widget in a html file if needed.</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co"># library(htmlwidgets)</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co"># saveWidget(p, file=paste0( getwd(), &quot;/HtmlWidget/bubblemapUK.html&quot;))</span></span></code></pre></div>
<!-- Close container -->
</div>
</div>
<!-- ============================ RELATED SECTION ============================ -->
<section class="bg-light" id="portfolio_landing" style="padding-top: 30px; padding-bottom: 30px; margin-top: 100px;">

<div class="container">

  <p class="mySeryTitle">Related chart types</p>
  <hr>
  <div class="row">
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Map150.png" alt="">
      </a>
      <div class="captionPortfolio">Map</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="choropleth-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Choropleth150.png" alt="">
      </a>
      <div class="captionPortfolio">Choropleth</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="hexbin-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/MapHexbin150.png" alt="">
      </a>
      <div class="captionPortfolio">Hexbin map</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="cartogram.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Cartogram150.png" alt="">
      </a>
      <div class="captionPortfolio">Cartogram</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="connection-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/ConnectedMap150.png" alt="">
      </a>
      <div class="captionPortfolio">Connection</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="bubble-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/BubbleMap150.png" alt="">
      </a>
      <div class="captionPortfolio">Bubble map</div>
    </div>
  </div>

</div>
</section> 
    <!-- ============================ CONTACT SECTION ============================ -->
    <section
      id="contact"
      class="bg"
      style="background-color: white; padding-top: 60px"
    >
      <div class="container">
        <div class="row">
          <div class="col-lg-2 text-center"></div>
          <div class="col-lg-8 text-center">
            <br /><br /><br />
            <h2 class="section-heading text-uppercase" style="color: black">
              Contact
            </h2>
            <p>
              This document is a work by
              <a href="https://www.yan-holtz.com">Yan Holtz</a>. Any feedback is
              highly encouraged. You can fill an issue on
              <a href="https://github.com/holtzy/D3-graph-gallery/issues"
                >Github</a
              >, drop me a message on
              <a href="https://twitter.com/R_Graph_Gallery">Twitter</a>, or send
              an email pasting <a href="">yan.holtz.data</a> with
              <a href="">gmail.com</a>.
            </p>
            <div style="text-align: center">
              <a
                class="btn btn-primary btn-xl text-uppercase js-scroll-trigger"
                href="https://github.com/holtzy"
                >Github</a
              >
              <a
                class="btn btn-primary btn-xl text-uppercase js-scroll-trigger"
                href="https://twitter.com/R_Graph_Gallery"
                >Twitter</a
              >
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============================ FOOTER SECTION ============================ -->

    <!-- AdThrive Footer Code Start-->
    <script
      type="text/javascript"
      async
      src="https://btloader.com/tag?o=5698917485248512&upapi=true&domain=r-graph-gallery.com"
    ></script>
    <script>
      !(function () {
        "use strict";
        var e;
        (e = document),
          (function () {
            var t, n;
            function r() {
              var t = e.createElement("script");
              (t.src =
                "https://cafemedia-com.videoplayerhub.com/galleryplayer.js"),
                e.head.appendChild(t);
            }
            function a() {
              var t = e.cookie.match("(^|[^;]+)\s*__adblocker\s*=\s*([^;]+)");
              return t && t.pop();
            }
            function c() {
              clearInterval(n);
            }
            return {
              init: function () {
                var e;
                "true" === (t = a())
                  ? r()
                  : ((e = 0),
                    (n = setInterval(function () {
                      (100 !== e && "false" !== t) || c(),
                        "true" === t && (r(), c()),
                        (t = a()),
                        e++;
                    }, 50)));
              },
            };
          })().init();
      })();
    </script>
    <!-- AdThrive Footer Code End -->

    <footer class="bg-light" id="myFooter">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <span class="copyright"
              >Copyright &copy; the R graph gallery 2018</span
            >
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a href="https://twitter.com/R_Graph_Gallery">
                  <i class="fa fa-twitter"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/holtzy">
                  <i class="fa fa-github"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                  <i class="fa fa-linkedin"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a href="#">Privacy Policy</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Terms of Use</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script>

      // add bootstrap table styles to pandoc tables
      function bootstrapStylePandocTables() {
        $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
      }
      $(document).ready(function () {
        bootstrapStylePandocTables();
      });

          </script>

    
    <!-- ============================ JAVASCRIPT SECTION ============================ -->

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>
  </body>
</html>
