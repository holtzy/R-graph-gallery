<!doctype html>
<html lang="en">
  <head>
    <!-- Google Analytics + AdThrive -->

    <!-- AdThrive Head Tag Manual -->
    <script data-no-optimize="1" data-cfasync="false">
      (function (w, d) {
        w.adthrive = w.adthrive || {};
        w.adthrive.cmd = w.adthrive.cmd || [];
        w.adthrive.plugin = "adthrive-ads-manual";
        w.adthrive.host = "ads.adthrive.com";
        var s = d.createElement("script");
        s.async = true;
        s.referrerpolicy = "no-referrer-when-downgrade";
        s.src =
          "https://" +
          w.adthrive.host +
          "/sites/6434363fc11d8059e61106b4/ads.min.js?referrer=" +
          w.encodeURIComponent(w.location.href) +
          "&cb=" +
          (Math.floor(Math.random() * 100) + 1);
        var n = d.getElementsByTagName("script")[0];
        n.parentNode.insertBefore(s, n);
      })(window, document);
    </script>
    <!-- End of AdThrive Head Tag -->

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-79254642-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-79254642-1");
    </script>

    <!-- Google Analytics + OutboundLink + Google Adsense -->

    <meta charset="utf-8" />
    <title>Choropleth Map with Bar Chart in
R &#8211; the R Graph Gallery</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="This post describes how to build a
choropleth map together with a bar chart in R using ggplot2 and
patchwork." />
    <meta
      name="keywords"
      content="R,ggplot2,tidyverse,Example,Data,Dataviz,Datavisualization,Plot,Chart,Graph,Learning,Caveat,Pitfall,Mistake"
    />
    <meta name="author" content="Yan Holtz" />
    <link rel="icon" href="img/logo/R_single_small.png" />

    <!-- Control appearance when shared by social media -->
    <meta property="og:title" content="Choropleth Map with Bar Chart in
R" />
    <meta
      property="og:image"
      content="https://www.r-graph-gallery.com/img/overview_RGG.png"
    />
    <meta property="og:description" content="This post describes how to
build a choropleth map together with a bar chart in R using ggplot2 and
patchwork." />
    <meta
      property="og:url"
      content="https://www.r-graph-gallery.com/web-choropleth-map-bar-chart.html"
    />
    <meta property="og:type" content="website" />

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom fonts for this template -->
    <link
      href="vendor/font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet" />

    <!-- JQUERY -->
    <script src="vendor/jquery/jquery.min.js"></script>
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="1">
    <!-- THIS ALLOWS TO INSERT THE MENU THAT IS STORED IN A MENU.HTML FILE-->
    <nav class="navbar navbar-expand-lg fixed-top" id="mainNav"></nav>
    <script>
      $(function () {
        $("#mainNav").load("html_chunk/menu.html");
      });
    </script>

    <!-- THIS ALLOWS TO INSERT THE MODAL OF THE MENU THAT IS STORED IN A MENU_MODAL.HTML FILE-->
    <div id="modal_menu_insertion"></div>
    <script>
      $(function () {
        $("#modal_menu_insertion").load("html_chunk/menu_modal.html");
      });
    </script>

    <!-- Header = Title in big + social media Icon + quick description -->
    <header class="masthead" style="padding-bottom: 30px">
      <div class="textlanding">
        <center><h1>Choropleth Map with Bar Chart in R</h1></center>
        <hr class="short_hr" />
        <br />
        <ul class="list-inline social-buttons">
          <li class="list-inline-item">
            <a href="https://twitter.com/R_Graph_Gallery">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://github.com/holtzy">
              <i class="fa fa-github" style="color: white"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.yan-holtz.com">
              <i class="fa fa-home"></i>
            </a>
          </li>
        </ul>
        <center>
          <p style="max-width: 600px; margin-top: 40px">This post
explains how to create a choropleth map alongside a bar chart in R using
<a href="ggplot2-package.html">ggplot2</a> and <a
href="package/patchwork.html">patchwork</a>.<br><br>This post will guide
you <strong>step by step</strong> through the process of constructing
this chart. It will also explain <strong>how to use bins</strong> to
categorize the <strong>continuous variable</strong> HDI and how to
<strong>calculate</strong> the proportion of the total population within
each HDI group.</p>
        </center>
        <div style="text-align: center">
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="choropleth-map.html"
            >Choropleth section</a
          >
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="https://www.data-to-viz.com/graph/choropleth.html"
            >About Maps</a
          >
        </div>
      </div>
    </header>

    <!-- THIS ALLOWS TO INSERT THE ADVERTISEMENT BANNER THAT IS STORED IN A BANNER.HTML FILE-->
    <div id="position_for_images"></div>
    <script>
      $(function () {
        $("#position_for_images").load("html_chunk/images.html");
      });
    </script>

    
    <!-- STYLE for chart pages but not the rest of tthe website -->
    <style>
      img {
        margin-top: 20px;
      }
    </style>

    <div class="container">
<div id="about" class="section level1">
<h1>About</h1>
<hr />
<p>This visualization shows the <strong>Human Development Index</strong>
(HDI) at the subregional level in Sao Paulo, Brazil‚Äôs largest city. The
values follow the standard United Nations‚Äôs HDI: values are in the
<strong>0 to 1 range</strong>. The visualization combines a <a
href="choropleth-map.html">choropleth map</a> with a bar chart using the
<a href="package/patchwork.html">patchwork</a> package.</p>
<p>This is the the work of <a
href="https://restateinsight.com/">Vinicius Oike Reginatto</a>. Thanks
to him for accepting sharing his work here! üôè</p>
<p>As a teaser, here is the map we‚Äôll learn how to build:</p>
<center>
<img src="img/graph/web-choropleth-barchart-map.png"
style="width:95.0%" />
</center>
</div>
<div id="data-and-libraries" class="section level1">
<h1>Data and Libraries</h1>
<hr />
<p>To follow this tutorial you will need the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<p>The HDI estimates are from the <a
href="http://www.atlasbrasil.org.br">Atlas of Human Development in
Brazil</a> and to make this tutorial easier to follow I cleaned the data
and made it available on my GitHub. To import the data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>atlas <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="st">&quot;https://github.com/viniciusoike/restateinsight/raw/main/static/data/atlas_sp_hdi.rds&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="basic-map" class="section level1">
<h1>Basic Map</h1>
<hr />
<p>At its core, this visualization is a <a
href="choropleth-map.html">choropleth map</a> that shows the spatial
distribution of the Human Development Index (HDI) in S√£o Paulo. The code
below uses <code>geom_sf</code> to make the map. The additional argument
<code>lwd</code> makes the lines of each border thinner and
<code>color</code> changes the color of the line.</p>
<p>Each <strong>polygon</strong> represents a ‚ÄúHuman Development Unit‚Äù
and can be interpreted like a small neighborhood.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">ggplot</span>(atlas) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> HDI), <span class="at">lwd =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p><img src="web-choropleth-barchart-map_files/figure-html/base-choropleth-1.png" width="90%" /></p>
</div>
<div id="using-bins" class="section level1">
<h1>Using bins</h1>
<hr />
<p>We use bins to group the <strong>continuous variable</strong> HDI.
This makes it easier to visualize the data and to find <strong>spatial
clusters</strong>. There are many ways to do this but here we use the
<code>scale_fill_fermenter</code> function directly. This is a quick and
easy approach to binning a continuous variable. This function also makes
a - in my opinion - nicer looking color legend.</p>
<p>The color palettes from <code>RColorBrewer</code> work very well for
maps and we use the <code>YlGnBu</code> palette. We specifiy the
<strong>breaks of the intervals</strong> mannually using the
<code>breaks</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">ggplot</span>(atlas) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> HDI), <span class="at">lwd =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">scale_fill_fermenter</span>(</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.65</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span>),</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="at">direction =</span> <span class="dv">1</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;YlGnBu&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="web-choropleth-barchart-map_files/figure-html/binned-choropleth-1.png" width="90%" /></p>
</div>
<div id="final-map" class="section level1">
<h1>Final Map</h1>
<hr />
<p>The finished version of the map includes simple labels and uses
<code>theme_map()</code> from the <code>ggthemes</code> package. The
arguments inside the <code>theme</code> function mostly change the
<strong>size and the alignment</strong> of the text labels. For your
final plot you‚Äôll most likely want to change the
<code>legend.key.size</code> and <code>plot.title</code> size
arguments.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>pmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(atlas) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> HDI), <span class="at">lwd =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">scale_fill_fermenter</span>(</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.65</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span>),</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="at">direction =</span> <span class="dv">1</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;YlGnBu&quot;</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;HDI in Sao Paulo, BR (2010)&quot;</span>,</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Microregion HDI in Sao Paulo&quot;</span>,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Source: Atlas Brasil&quot;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="co"># Legend</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    <span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">1.25</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">1.75</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>    <span class="at">legend.margin =</span> <span class="fu">margin</span>(),</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>    <span class="co"># Increase size and horizontal alignment of the both the title and subtitle</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">28</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>  )</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>pmap</span></code></pre></div>
<p><img src="web-choropleth-barchart-map_files/figure-html/final-choropleth-1.svg" width="100%" height="900px" /></p>
</div>
<div id="the-bar-chart" class="section level1">
<h1>The Bar Chart</h1>
<hr />
<p>To make the <a href="barplot.html">bar chart</a> we need to transform
the data. We want to calculate the share of the total population that
lives within each HDI group.</p>
<p>To make the same groups as those created by
<code>scale_fill_fermenter</code> we use <code>findInterval</code> using
the <strong>same breaks</strong> and <strong>right-closed
intervals</strong>. To find this we group by <code>group_hdi</code>, sum
the <code>pop</code> (population) of these regions, and compute the
percent share within each group.</p>
<p>This bar chart serves two goals: - first, it shows the distribution
of the population across all HDI groups - second, it compensates for
<em>map area bias</em>, a common pitfall of choropleths. Map area bias
refers to the natural tendency to attribute greater weight/importance to
larger areas.</p>
<p>Looking at the <a href="map.html">map</a>, we see very large areas in
the southernmost part of the city that have low values of HDI. These
areas however <strong>are not densely populated</strong> and account for
a relatively small share of the city‚Äôs population.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Calculate population share in each HDI group</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>pop_hdi <span class="ot">&lt;-</span> atlas <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="at">group_hdi =</span> <span class="fu">findInterval</span>(HDI, <span class="fu">seq</span>(<span class="fl">0.65</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span>), <span class="at">left.open =</span> <span class="cn">FALSE</span>),</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="at">group_hdi =</span> <span class="fu">factor</span>(group_hdi)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">group_by</span>(group_hdi) <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">score =</span> <span class="fu">sum</span>(pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share =</span> score <span class="sc">/</span> <span class="fu">sum</span>(score) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="fu">ggplot</span>(pop_hdi, <span class="fu">aes</span>(group_hdi, share, <span class="at">fill =</span> group_hdi)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code></pre></div>
<p><img src="web-choropleth-barchart-map_files/figure-html/base-bar-chart-1.png" width="672" /></p>
</div>
<div id="using-text-labels" class="section level1">
<h1>Using text labels</h1>
<hr />
<p>Instead of using axis labels we plot the value of each group directly
<strong>on top of each bar</strong>. To improve readability we make the
color of the text labels variable (black or white) and also nudge the
label of the first and last group horizontally.</p>
<p>Getting the right amount of horizontal nudge requires some
<strong>trial and error</strong> and also depends on the size of your
final visualization. In your own chart, you‚Äôll most likely change the
<code>share + 3</code>/<code>share - 3</code> and the <code>size</code>
argument in <code>geom_text</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Create a variable to store the position of the text label</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>pop_hdi <span class="ot">&lt;-</span> pop_hdi <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="at">y_text =</span> <span class="fu">if_else</span>(group_hdi <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>), share <span class="sc">+</span> <span class="dv">3</span>, share <span class="sc">-</span> <span class="dv">3</span>),</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(share, <span class="dv">1</span>), <span class="st">&quot;%&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  )</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="fu">ggplot</span>(pop_hdi, <span class="fu">aes</span>(group_hdi, share, <span class="at">fill =</span> group_hdi)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  <span class="co"># Text labels</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y_text, <span class="at">label =</span> label, <span class="at">color =</span> group_hdi),</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  <span class="co"># Use the same color palette as the map</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;YlGnBu&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  <span class="co"># Swap between black and white text</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">&quot;white&quot;</span>, <span class="dv">2</span>), <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>  <span class="co"># Hide color legend</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>, <span class="at">color =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="web-choropleth-barchart-map_files/figure-html/bar-chart-labels-1.png" width="672" /></p>
</div>
<div id="final-bar-chart" class="section level1">
<h1>Final Bar Chart</h1>
<hr />
<p>We use a <strong>custom label</strong> for the final version of this
plot.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Labels for the color legend</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>x_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="st">&quot;0.650 or less&quot;</span>, <span class="st">&quot;0.650 to 0.699&quot;</span>, <span class="st">&quot;0.700 to 0.749&quot;</span>, <span class="st">&quot;0.750 to 0.799&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="st">&quot;0.800 to 0.849&quot;</span>, <span class="st">&quot;0.850 to 0.899&quot;</span>, <span class="st">&quot;0.900 to 0.949&quot;</span>, <span class="st">&quot;0.950 or more&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  )</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>pcol <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pop_hdi, <span class="fu">aes</span>(group_hdi, share, <span class="at">fill =</span> group_hdi)) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y_text, <span class="at">label =</span> label, <span class="at">color =</span> group_hdi),</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> x_labels) <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;YlGnBu&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">&quot;white&quot;</span>, <span class="dv">2</span>), <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>, <span class="at">color =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Population share by HDI group&quot;</span>,</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>  )</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>pcol</span></code></pre></div>
<p><img src="web-choropleth-barchart-map_files/figure-html/bar-chart-final-1.png" width="672" /></p>
</div>
<div id="the-final-plot" class="section level1">
<h1>The final plot</h1>
<hr />
<p>To join both plots we use the <code>inset_element</code> function
from the <a href="package/patchwork.html">patchwork</a> package. Use the
arguments inside this function to customize the display size of the bar
chart.</p>
<p>In this final visualization we can see that nearly 40% of the city‚Äôs
population lives in regions with an HDI range of 0.700-0.799. These
areas are primarily located in the peripheral parts of the city,
including the southern, eastern, and northern sections. In contrast, the
central part of the city, which has the highest HDI areas, accounts for
less than 15% of the total population.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>p_hdi_atlas <span class="ot">&lt;-</span> </span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  pmap <span class="sc">+</span> <span class="fu">inset_element</span>(pcol, <span class="at">left =</span> <span class="fl">0.50</span>, <span class="at">bottom =</span> <span class="fl">0.05</span>, <span class="at">right =</span> <span class="dv">1</span>, <span class="at">top =</span> <span class="fl">0.5</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>p_hdi_atlas</span></code></pre></div>
<p><img src="web-choropleth-barchart-map_files/figure-html/final-viz-1.svg" width="100%" height="900px" /></p>
<p>As stated previously, the combination of a bar chart (or histogram)
with a choropleth makes for a powerful and insightful combination. Happy
mapping!</p>
<p><strong>Author</strong>: <a
href="https://restateinsight.com/aboutme">Vinicius Oike
Reginatto</a></p>
<p><strong>Data</strong>: <a href="http://www.atlasbrasil.org.br">Atlas
of Human Development in Brazil</a></p>
</div>
<div id="going-further" class="section level1">
<h1>Going Further</h1>
<hr />
<p>You might be interested in:</p>
<ul>
<li>creating a <a href="web-valued-dots-map-bertin.html">map in the
style of Jacques Bertin</a></li>
<li>how to combine a <a
href="web-dorling-cartogram-with-R.html">cartogram with a bubble
map</a></li>
<li>this other <a
href="327-chloropleth-map-from-geojson-with-ggplot2.html">choropleth
map</a> about French restaurants</li>
</ul>
<!-- Close container -->
</div>
</div>
<!-- ============================ RELATED SECTION ============================ -->
<section class="bg-light" id="portfolio_landing" style="padding-top: 30px; padding-bottom: 30px; margin-top: 100px;">

<div class="container">

  <p class="mySeryTitle">Related chart types</p>
  <hr>
  <div class="row">
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Map150.png" alt="">
      </a>
      <div class="captionPortfolio">Map</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="choropleth-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Choropleth150.png" alt="">
      </a>
      <div class="captionPortfolio">Choropleth</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="hexbin-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/MapHexbin150.png" alt="">
      </a>
      <div class="captionPortfolio">Hexbin map</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="cartogram.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Cartogram150.png" alt="">
      </a>
      <div class="captionPortfolio">Cartogram</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="connection-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/ConnectedMap150.png" alt="">
      </a>
      <div class="captionPortfolio">Connection</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="bubble-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/BubbleMap150.png" alt="">
      </a>
      <div class="captionPortfolio">Bubble map</div>
    </div>
  </div>

</div>
</section> 
    <!-- ============================ CONTACT SECTION ============================ -->
    <section
      id="contact"
      class="bg"
      style="background-color: white; padding-top: 60px"
    >
      <div class="container">
        <div class="row">
          <div class="col-lg-2 text-center"></div>
          <div class="col-lg-8 text-center">
            <br /><br /><br />
            <h2>‚ù§Ô∏è 10 best R tricks ‚ù§Ô∏è</h2>
            <p style="max-width: 620px; text-align: center">
              üëã After crafting hundreds of R charts over 12 years, I've
              distilled my top 10 tips and tricks. Receive them via email!
              <b>One insight per day for the next 10 days</b>! üî•
            </p>
            <div style="display: flex; justify-content: center">
              <script
                async
                data-uid="329fda5a7e"
                src="https://prodigious-trailblazer-3628.ck.page/329fda5a7e/index.js"
              ></script>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============================ FOOTER SECTION ============================ -->

    <!-- AdThrive Footer Code Start-->
    <script
      type="text/javascript"
      async
      src="https://btloader.com/tag?o=5698917485248512&upapi=true&domain=r-graph-gallery.com"
    ></script>
    <script>
      !(function () {
        "use strict";
        var e;
        (e = document),
          (function () {
            var t, n;
            function r() {
              var t = e.createElement("script");
              (t.src =
                "https://cafemedia-com.videoplayerhub.com/galleryplayer.js"),
                e.head.appendChild(t);
            }
            function a() {
              var t = e.cookie.match("(^|[^;]+)\s*__adblocker\s*=\s*([^;]+)");
              return t && t.pop();
            }
            function c() {
              clearInterval(n);
            }
            return {
              init: function () {
                var e;
                "true" === (t = a())
                  ? r()
                  : ((e = 0),
                    (n = setInterval(function () {
                      (100 !== e && "false" !== t) || c(),
                        "true" === t && (r(), c()),
                        (t = a()),
                        e++;
                    }, 50)));
              },
            };
          })().init();
      })();
    </script>
    <!-- AdThrive Footer Code End -->

    <footer class="bg-light" id="myFooter">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <span class="copyright"
              >Copyright &copy; the R graph gallery 2018</span
            >
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a href="https://twitter.com/R_Graph_Gallery">
                  <i class="fa fa-twitter"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/holtzy">
                  <i class="fa fa-github"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                  <i class="fa fa-linkedin"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a href="#">Privacy Policy</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Terms of Use</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script>

      // add bootstrap table styles to pandoc tables
      function bootstrapStylePandocTables() {
        $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
      }
      $(document).ready(function () {
        bootstrapStylePandocTables();
      });

          </script>

    
    <!-- ============================ JAVASCRIPT SECTION ============================ -->

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>
  </body>
</html>
