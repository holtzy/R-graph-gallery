<!doctype html>
<html lang="en">
  <head>
    <!-- Google Analytics + AdThrive -->

    <!-- AdThrive Head Tag Manual -->
    <script data-no-optimize="1" data-cfasync="false">
      (function (w, d) {
        w.adthrive = w.adthrive || {};
        w.adthrive.cmd = w.adthrive.cmd || [];
        w.adthrive.plugin = "adthrive-ads-manual";
        w.adthrive.host = "ads.adthrive.com";
        var s = d.createElement("script");
        s.async = true;
        s.referrerpolicy = "no-referrer-when-downgrade";
        s.src =
          "https://" +
          w.adthrive.host +
          "/sites/6434363fc11d8059e61106b4/ads.min.js?referrer=" +
          w.encodeURIComponent(w.location.href) +
          "&cb=" +
          (Math.floor(Math.random() * 100) + 1);
        var n = d.getElementsByTagName("script")[0];
        n.parentNode.insertBefore(s, n);
      })(window, document);
    </script>
    <!-- End of AdThrive Head Tag -->

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-79254642-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-79254642-1");
    </script>

    <!-- Google Analytics + OutboundLink + Google Adsense -->

    <meta charset="utf-8" />
    <title>
      Time series with conditional area fill and geofaceting in ggplot2 &#8211;
      the R Graph Gallery
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="description"
      content="This post explains how to build multiple lineplots with filled areas and a customized layout to explore the evolution of animal rescues across different boroughs in London. Step by step code snippets with explanations are provided. Built with R and the tidyverse."
    />
    <meta
      name="keywords"
      content="R,ggplot2,tidyverse,Example,Data,Dataviz,Datavisualization,Plot,Chart,Graph,Learning,Caveat,Pitfall,Mistake"
    />
    <meta name="author" content="Yan Holtz" />
    <link rel="icon" href="img/logo/R_single_small.png" />

    <!-- Control appearance when shared by social media -->
    <meta
      property="og:title"
      content="Time series with conditional area fill and geofaceting in ggplot2"
    />
    <meta
      property="og:image"
      content="https://www.r-graph-gallery.com/img/overview_RGG.png"
    />
    <meta
      property="og:description"
      content="This post explains how to build multiple lineplots with filled areas and a customized layout to explore the evolution of animal rescues across different boroughs in London. Step by step code snippets with explanations are provided. Built with R and the tidyverse."
    />
    <meta
      property="og:url"
      content="https://www.r-graph-gallery.com/web-time-series-and-facetting.html"
    />
    <meta property="og:type" content="website" />

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom fonts for this template -->
    <link
      href="vendor/font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet" />

    <!-- JQUERY -->
    <script src="vendor/jquery/jquery.min.js"></script>
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="1">
    <!-- THIS ALLOWS TO INSERT THE MENU THAT IS STORED IN A MENU.HTML FILE-->
    <nav class="navbar navbar-expand-lg fixed-top" id="mainNav"></nav>
    <script>
      $(function () {
        $("#mainNav").load("html_chunk/menu.html");
      });
    </script>

    <!-- THIS ALLOWS TO INSERT THE MODAL OF THE MENU THAT IS STORED IN A MENU_MODAL.HTML FILE-->
    <div id="modal_menu_insertion"></div>
    <script>
      $(function () {
        $("#modal_menu_insertion").load("html_chunk/menu_modal.html");
      });
    </script>

    <div id="modal_subscribe_insertion"></div>
    <script>
      $(function () {
        $("#modal_subscribe_insertion").load("html_chunk/subscribe_modal.html");
      });
    </script>

    <!-- Header = Title in big + social media Icon + quick description -->
    <header class="masthead" style="padding-bottom: 30px">
      <div class="textlanding">
        <center>
          <h1>
            Time series with conditional area fill and geofaceting in ggplot2
          </h1>
        </center>
        <hr class="short_hr" />
        <br />
        <ul class="list-inline social-buttons">
          <li class="list-inline-item">
            <a href="https://twitter.com/R_Graph_Gallery">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://github.com/holtzy">
              <i class="fa fa-github" style="color: white"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.yan-holtz.com">
              <i class="fa fa-home"></i>
            </a>
          </li>
        </ul>
        <center>
          <p style="max-width: 600px; margin-top: 40px">
            Multiple lineplots with conditional area fill and geofaceting to
            explore the evolution of animal rescues across different boroughs in
            London made with <code>R</code> and <code>ggplot2</code>. This
            blogpost guides you step-by-step through the construction of all the
            components of beautiful-looking lineplots with filled areas and how
            to put them into a layout based on geographical units.
          </p>
        </center>
        <div style="text-align: center">
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="line-plot.html"
            >Line chart Section</a
          >
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="https://www.data-to-viz.com/graph/line.html"
            >Data to Viz</a
          >
        </div>
      </div>
    </header>

    <!-- THIS ALLOWS TO INSERT THE ADVERTISEMENT BANNER THAT IS STORED IN A BANNER.HTML FILE-->
    <div id="position_for_images"></div>
    <script>
      $(function () {
        $("#position_for_images").load("html_chunk/images.html");
      });
    </script>

    <!-- STYLE for chart pages but not the rest of tthe website -->
    <style>
      img {
        margin-top: 20px;
      }
    </style>

    <div class="container" style="padding-top: 100px">
      <div id="about" class="section level1">
        <h1>About</h1>
        <hr />
        <p>
          This page showcases the work of
          <a href="https://karaman.is/">Georgios Karamanis</a>, built for the
          <a href="https://github.com/rfordatascience/tidytuesday"
            >TidyTuesday</a
          >
          initiative. You can find the original code on his Github repository
          <a
            href="https://github.com/gkaramanis/tidytuesday/blob/master/2021/2021-week26/animal-rescues.R"
            >here</a
          >.
        </p>
        <p>
          Thanks to him for accepting sharing his work here! Thanks also to
          <a href="https://tcapretto.netlify.app/">Tom√°s Capretto</a> who split
          the original code into this step-by-step guide! üôèüôè
        </p>
        <p>As a teaser, here is the plot we‚Äôre gonna try building:</p>
        <center>
          <img
            src="img/fromTheWeb/web-time-series-and-facetting.png"
            style="width: 95%"
          />
        </center>
        <p><br /></p>
      </div>
      <div id="load-packages" class="section level1">
        <h1>Load packages</h1>
        <hr />
        <p>
          Let‚Äôs start by loading some libraries. On top of the
          <code>tidyverse</code>, today‚Äôs plot also depends on
          <a href="https://hafen.github.io/geofacet/"><code>geofacet</code></a>
          and <a href="https://teunbrand.github.io/ggh4x/"><code>ggh4x</code></a
          >. The first one provides geofaceting functionality for ggplot2, and
          the later provides some utility functions such as the
          <code>stat_difference()</code> that is going to be used here.
        </p>
        <p>
          <strong>Note:</strong> At the moment of writing, this guide uses the
          development version of <code>ggh4x</code> (v0.1.2.1.9), which can be
          installed from Github with
        </p>
        <div class="sourceCode" id="cb1">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;teunbrand/ggh4x&quot;</span>)</span></code></pre>
        </div>
        <p><br /></p>
        <div class="sourceCode" id="cb2">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geofacet)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggh4x)</span></code></pre>
        </div>
        <p><br /></p>
        <p>
          <strong>Fira Sans Compressed</strong> is going to be the default font
          for the plot and <strong>KyivType Sans</strong> is going to be used
          for the title. If you are a little unsure about how to work with
          custom fonts in R,
          <a
            href="https://www.r-graph-gallery.com/custom-fonts-in-R-and-ggplot2"
            >this post</a
          >
          is for you.
        </p>
      </div>
      <div id="load-and-prepare-the-data" class="section level1">
        <h1>Load and prepare the data</h1>
        <hr />
        <p>
          This guide shows how to create a highly customized and beautiful
          multi-panel lineplot to visualize the evolution of animal rescues by
          the London fire brigade for the different boroughs in the city.
        </p>
        <p>
          The data for this post originally comes from
          <a
            href="https://data.london.gov.uk/dataset/animal-rescue-incidents-attended-by-lfb"
            >London.gov</a
          >
          by way of
          <a href="https://www.data-is-plural.com/">Data is Plural</a> and
          <a href="https://www.karaman.is">Georgios Karamanis</a>. This guide
          uses the dataset released for the
          <a href="https://github.com/rfordatascience/tidytuesday"
            >TidyTuesday</a
          >
          initiative on the week of 2021-06-29. You can find the original
          announcement and more information about the data
          <a
            href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-06-29/readme.md"
            >here</a
          >. Thank you all for making this work possible!
        </p>
        <p>Let‚Äôs get started by loading the dataset:</p>
        <div class="sourceCode" id="cb3">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>animal_rescues <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-06-29/animal_rescues.csv&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Capitalize the type of animal</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_group_parent =</span> <span class="fu">str_to_sentence</span>(animal_group_parent))</span></code></pre>
        </div>
        <p><br /></p>
        <p>
          The <code>geofacet</code> library imports grid layouts from the
          <a href="https://github.com/hafen/grid-designer">grid-designer</a>
          repository. This repository has a lot of different grid layouts that
          represent the actual geographical layout of a large variety of
          neighborhoods within cities, cities within states, or even states
          within countries. Given that each borough in London represents a panel
          in today‚Äôs viz, we load the dataset named
          <code>gb_london_boroughs_grid</code> which represents the layout of
          the boroughs in London.
        </p>
        <div class="sourceCode" id="cb4">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>borough_names <span class="ot">&lt;-</span> gb_london_boroughs_grid <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">borough_code =</span> code_ons, name)</span></code></pre>
        </div>
        <p><br /></p>
        <p>Next, let‚Äôs process the data a little.</p>
        <div class="sourceCode" id="cb5">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rescues_borough <span class="ot">&lt;-</span> animal_rescues <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep rescues that happeend before 2021</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cal_year <span class="sc">&lt;</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We&#39;re interested on whether it is a Cat or another type of animal.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_group_parent =</span> <span class="fu">if_else</span>(animal_group_parent <span class="sc">==</span> <span class="st">&quot;Cat&quot;</span>, <span class="st">&quot;Cat&quot;</span>, <span class="st">&quot;Not_Cat&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of rescues per year, borough, and type of animal</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cal_year, borough_code, animal_group_parent) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the dataset wider.</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># * One column for the number of cat rescues</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># * Another column for the number of other animal rescues</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> animal_group_parent, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge the data with the info about the grid layout</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(borough_names) <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop entries with missing name</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(name)) </span></code></pre>
        </div>
        <p><br /></p>
      </div>
      <div id="basic-lineplot" class="section level1">
        <h1>Basic lineplot</h1>
        <hr />
        <p>
          Today‚Äôs chart consists of several lineplots that are arranged in a
          custom layout. Let‚Äôs start by trying to create only one of the panels
          in the plot. This will be very helpful to understand all the details
          behind this wonderful chart.
        </p>
        <div class="sourceCode" id="cb6">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s say we select the borough named &quot;Enfield&quot; </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> rescues_borough <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Enfield&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cal_year)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># One line for Cat rescues</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cat, <span class="at">color =</span> <span class="st">&quot;cats&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Another line for Not_Cat rescues</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Not_Cat, <span class="at">color =</span> <span class="st">&quot;other&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stat_difference() from ggh4x package applies the conditional fill</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># based on which of Not_Cat and Cat is larger.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_difference</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Not_Cat, <span class="at">ymax =</span> Cat), <span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code></pre>
        </div>
        <p>
          <img
            src="web-time-series-and-facetting_files/figure-html/unnamed-chunk-5-1.png"
            width="672"
          />
          <br />
        </p>
      </div>
      <div id="multipanel-layout-via-geofaceting" class="section level1">
        <h1>Multipanel layout via geofaceting</h1>
        <hr />
        <p>
          Fortunately, it‚Äôs quite easy to extend the single-panel plot to a
          multi-panel plot with ggplot2. In this case, the
          <code>facet_geo()</code> function from the
          <code>geofacet</code> package is going to provide the faceting based
          on the different boroughs in London
        </p>
        <div class="sourceCode" id="cb7">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rescues_borough, <span class="fu">aes</span>(<span class="at">x =</span> cal_year)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cat, <span class="at">color =</span> <span class="st">&quot;cats&quot;</span>)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Not_Cat, <span class="at">color =</span> <span class="st">&quot;other&quot;</span>)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_difference</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Not_Cat, <span class="at">ymax =</span> Cat), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vars(name): Use the values in the name variable to create the subpanels</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># grid = &quot;gb_london_boroughs_grid&quot;: use the London boroughs grid that comes</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with the geofacet package</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_geo</span>(<span class="fu">vars</span>(name), <span class="at">grid =</span> <span class="st">&quot;gb_london_boroughs_grid&quot;</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt </span></code></pre>
        </div>
        <p>
          <img
            src="web-time-series-and-facetting_files/figure-html/unnamed-chunk-6-1.png"
            width="95%"
          />
          <br />
        </p>
        <p>
          Wonderful! Sometimes it‚Äôs hard to believe that only one extra line of
          code separates this plot from the previous one.
        </p>
      </div>
      <div id="annotations-scales-and-colors" class="section level1">
        <h1>Annotations, scales, and colors</h1>
        <hr />
        <p>
          While geofaceting is really cool, it‚Äôs still necessary to improve the
          appearance of the plot. The first improvement is to use more
          attractive colors for the lines and the fill ‚Äì having different colors
          for these geoms does not feel quite right in this case. Then, breaks
          are manually specified for both axes. And finally, a title and a
          caption are added to give more information about the content of the
          plot and the source of the data.
        </p>
        <div class="sourceCode" id="cb8">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> plt <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colors for the lines</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#3D85F7&quot;</span>, <span class="st">&quot;#C32E5A&quot;</span>)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colors for the fill. They are lighter versions of the line colors.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The third one is required because lines are sometimes equal</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>      colorspace<span class="sc">::</span><span class="fu">lighten</span>(<span class="st">&quot;#3D85F7&quot;</span>), </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      colorspace<span class="sc">::</span><span class="fu">lighten</span>(<span class="st">&quot;#C32E5A&quot;</span>), </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;grey60&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;more cats&quot;</span>, <span class="st">&quot;more other&quot;</span>, <span class="st">&quot;same&quot;</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set breaks along both axes</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2010</span>, <span class="dv">2020</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add labels</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Rescues of</span><span class="sc">\n</span><span class="st">cats vs other animals by</span><span class="sc">\n</span><span class="st">the London fire brigade</span><span class="sc">\n</span><span class="st">2009-2020&quot;</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Source: London.gov ¬∑ Graphic: Georgios Karamanis&quot;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify the order for the guides</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Order indicates the order of each legend among multiple guides.</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The guide for &#39;color&#39; will be placed before the onde for &#39;fill&#39;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>), </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>plt</span></code></pre>
        </div>
        <p>
          <img
            src="web-time-series-and-facetting_files/figure-html/unnamed-chunk-7-1.png"
            width="95%"
          />
          <br />
        </p>
        <p>
          The plot is one step closer to its final version but some details need
          to be taken care of before it is ready. For example, panel labels need
          extra space in order to fit and the default theme is just too boring.
          Let‚Äôs work on those final tweaks!
        </p>
      </div>
      <div id="final-chart" class="section level1">
        <h1>Final chart</h1>
        <hr />
        <p>
          Now it‚Äôs time to <strong>customize the theme</strong>. First of all,
          the default font is replaced with
          <strong>Fira Sans Compressed</strong>. This is a slight change that
          makes the plot look much better. Then, the legend is shifted to a much
          better position on the top-right corner of the plot. The default takes
          valuable horizontal space and does not take advantage of the extra
          space due to the empty panels. And finally, we customize the
          background color as well as the styles for the title and the caption.
          Just note how better the viz looks thanks to using the
          <strong>KyivType Sans</strong> font for the title.
        </p>
        <div class="sourceCode" id="cb9">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> plt <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A minimalistic theme with no background annotations</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">&quot;Fira Sans Compressed&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top-right position</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.pos =</span> <span class="fu">c</span>(<span class="fl">0.875</span>, <span class="fl">0.975</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Elements within a guide are placed one next to the other in the same row</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Different guides are stacked vertically</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">&quot;vertical&quot;</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># No legend title</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Light background color</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#F5F4EF&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">20</span>, <span class="dv">30</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize the title. Note the new font family and its larger size.</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">100</span>, <span class="dv">0</span>), </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">26</span>, </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">&quot;KyivType Sans&quot;</span>, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>, </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;grey25&quot;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove titles for x and y axes.</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Specify color for the tick labels along both axes </span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;grey40&quot;</span>),</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Specify face and color for the text on top of each panel/facet</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey20&quot;</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>plt </span></code></pre>
        </div>
        <p>
          <img
            src="web-time-series-and-facetting_files/figure-html/unnamed-chunk-8-1.png"
            width="95%"
          />
        </p>
        <p><br /></p>
        <!-- Close container -->
      </div>
    </div>
    <!-- ============================ RELATED SECTION ============================ -->
    <section
      class="bg-light"
      id="portfolio_landing"
      style="padding-top: 30px; padding-bottom: 30px; margin-top: 100px"
    >
      <div class="container">
        <p class="mySeryTitle">Related chart types</p>
        <hr />
        <div class="row">
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="barplot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/section/Bar150.png" alt="" />
            </a>
            <div class="captionPortfolio">Barplot</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="spider-or-radar-chart.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/section/Spider150.png" alt="" />
            </a>
            <div class="captionPortfolio">Spider / Radar</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="wordcloud.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img
                class="img-fluid"
                src="img/section/Wordcloud150.png"
                alt=""
              />
            </a>
            <div class="captionPortfolio">Wordcloud</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="parallel-plot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img
                class="img-fluid"
                src="img/section/Parallel1150.png"
                alt=""
              />
            </a>
            <div class="captionPortfolio">Parallel</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="lollipop-plot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/section/Lollipop150.png" alt="" />
            </a>
            <div class="captionPortfolio">Lollipop</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="circular-barplot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img
                class="img-fluid"
                src="img/section/CircularBarplot150.png"
                alt=""
              />
            </a>
            <div class="captionPortfolio">Circular Barplot</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============================ CONTACT SECTION ============================ -->
    <section
      id="contact"
      class="bg"
      style="background-color: white; padding-top: 60px"
    >
      <div class="container">
        <div class="row">
          <div class="col-lg-2 text-center"></div>
          <div class="col-lg-8 text-center">
            <br /><br /><br />
            <h2 class="section-heading text-uppercase" style="color: black">
              Contact
            </h2>
            <p>
              This document is a work by
              <a href="https://www.yan-holtz.com">Yan Holtz</a>. Any feedback is
              highly encouraged. You can fill an issue on
              <a href="https://github.com/holtzy/D3-graph-gallery/issues"
                >Github</a
              >, drop me a message on
              <a href="https://twitter.com/R_Graph_Gallery">Twitter</a>, or send
              an email pasting <a href="">yan.holtz.data</a> with
              <a href="">gmail.com</a>.
            </p>
            <div style="text-align: center">
              <a
                class="btn btn-primary btn-xl text-uppercase js-scroll-trigger"
                href="https://github.com/holtzy"
                >Github</a
              >
              <a
                class="btn btn-primary btn-xl text-uppercase js-scroll-trigger"
                href="https://twitter.com/R_Graph_Gallery"
                >Twitter</a
              >
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============================ FOOTER SECTION ============================ -->

    <!-- AdThrive Footer Code Start-->
    <script
      type="text/javascript"
      async
      src="https://btloader.com/tag?o=5698917485248512&upapi=true&domain=r-graph-gallery.com"
    ></script>
    <script>
      !(function () {
        "use strict";
        var e;
        (e = document),
          (function () {
            var t, n;
            function r() {
              var t = e.createElement("script");
              (t.src =
                "https://cafemedia-com.videoplayerhub.com/galleryplayer.js"),
                e.head.appendChild(t);
            }
            function a() {
              var t = e.cookie.match("(^|[^;]+)\s*__adblocker\s*=\s*([^;]+)");
              return t && t.pop();
            }
            function c() {
              clearInterval(n);
            }
            return {
              init: function () {
                var e;
                "true" === (t = a())
                  ? r()
                  : ((e = 0),
                    (n = setInterval(function () {
                      (100 !== e && "false" !== t) || c(),
                        "true" === t && (r(), c()),
                        (t = a()),
                        e++;
                    }, 50)));
              },
            };
          })().init();
      })();
    </script>
    <!-- AdThrive Footer Code End -->

    <footer class="bg-light" id="myFooter">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <span class="copyright"
              >Copyright &copy; the R graph gallery 2018</span
            >
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a href="https://twitter.com/R_Graph_Gallery">
                  <i class="fa fa-twitter"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/holtzy">
                  <i class="fa fa-github"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                  <i class="fa fa-linkedin"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a href="#">Privacy Policy</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Terms of Use</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // add bootstrap table styles to pandoc tables
      function bootstrapStylePandocTables() {
        $("tr.header")
          .parent("thead")
          .parent("table")
          .addClass("table table-condensed");
      }
      $(document).ready(function () {
        bootstrapStylePandocTables();
      });
    </script>

    <!-- ============================ JAVASCRIPT SECTION ============================ -->

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>
  </body>
</html>
