<!doctype html>
<html lang="en">
  <head>
    <!-- Google Analytics + AdThrive -->

    <!-- AdThrive Head Tag Manual -->
    <script data-no-optimize="1" data-cfasync="false">
      (function (w, d) {
        w.adthrive = w.adthrive || {};
        w.adthrive.cmd = w.adthrive.cmd || [];
        w.adthrive.plugin = "adthrive-ads-manual";
        w.adthrive.host = "ads.adthrive.com";
        var s = d.createElement("script");
        s.async = true;
        s.referrerpolicy = "no-referrer-when-downgrade";
        s.src =
          "https://" +
          w.adthrive.host +
          "/sites/6434363fc11d8059e61106b4/ads.min.js?referrer=" +
          w.encodeURIComponent(w.location.href) +
          "&cb=" +
          (Math.floor(Math.random() * 100) + 1);
        var n = d.getElementsByTagName("script")[0];
        n.parentNode.insertBefore(s, n);
      })(window, document);
    </script>
    <!-- End of AdThrive Head Tag -->

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-79254642-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-79254642-1");
    </script>

    <!-- Google Analytics + OutboundLink + Google Adsense -->

    <meta charset="utf-8" />
    <title>
      Visualizing a distribution with Waffle Charts in R &#8211; the R Graph
      Gallery
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="description"
      content="This post explains how to
represent the distribution of several groups, using a mix between a
histogram and a waffle chart. It has nice features such as annotations
and others and is made using R and ggplot2. Reproducible code and an
explanation are provided."
    />
    <meta
      name="keywords"
      content="R,ggplot2,tidyverse,Example,Data,Dataviz,Datavisualization,Plot,Chart,Graph,Learning,Caveat,Pitfall,Mistake"
    />
    <meta name="author" content="Yan Holtz" />
    <link rel="icon" href="img/logo/R_single_small.png" />

    <!-- Control appearance when shared by social media -->
    <meta
      property="og:title"
      content="Visualizing a distribution with
Waffle Charts in R"
    />
    <meta
      property="og:image"
      content="https://www.r-graph-gallery.com/img/overview_RGG.png"
    />
    <meta
      property="og:description"
      content="This post explains how to
represent the distribution of several groups, using a mix between a
histogram and a waffle chart. It has nice features such as annotations
and others and is made using R and ggplot2. Reproducible code and an
explanation are provided."
    />
    <meta
      property="og:url"
      content="https://www.r-graph-gallery.com/web-waffle-chart-for-distribution.html"
    />
    <meta property="og:type" content="website" />

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom fonts for this template -->
    <link
      href="vendor/font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet" />

    <!-- JQUERY -->
    <script src="vendor/jquery/jquery.min.js"></script>
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="1">
    <!-- THIS ALLOWS TO INSERT THE MENU THAT IS STORED IN A MENU.HTML FILE-->
    <nav class="navbar navbar-expand-lg fixed-top" id="mainNav"></nav>
    <script>
      $(function () {
        $("#mainNav").load("html_chunk/menu.html");
      });
    </script>

    <!-- THIS ALLOWS TO INSERT THE MODAL OF THE MENU THAT IS STORED IN A MENU_MODAL.HTML FILE-->
    <div id="modal_menu_insertion"></div>
    <script>
      $(function () {
        $("#modal_menu_insertion").load("html_chunk/menu_modal.html");
      });
    </script>

    <div id="modal_subscribe_insertion"></div>
    <script>
      $(function () {
        $("#modal_subscribe_insertion").load("html_chunk/subscribe_modal.html");
      });
    </script>

    <!-- Header = Title in big + social media Icon + quick description -->
    <header class="masthead" style="padding-bottom: 30px">
      <div class="textlanding">
        <center>
          <h1>Visualizing a distribution with Waffle Charts in R</h1>
        </center>
        <hr class="short_hr" />
        <br />
        <ul class="list-inline social-buttons">
          <li class="list-inline-item">
            <a href="https://twitter.com/R_Graph_Gallery">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://github.com/holtzy">
              <i class="fa fa-github" style="color: white"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
          <li class="list-inline-item social-buttons">
            <a href="https://www.yan-holtz.com">
              <i class="fa fa-home"></i>
            </a>
          </li>
        </ul>
        <center>
          <p style="max-width: 600px; margin-top: 40px">
            This post explains how to represent the distribution of several
            groups, using a mix between a histogram and a
            <a href="https://r-graph-gallery.com/waffle.html">waffle chart</a>.
            It has nice features such as annotations and others and is made
            using R and
            <a href="https://r-graph-gallery.com/ggplot2-package.html"
              >ggplot2</a
            >.
          </p>
        </center>
        <div style="text-align: center">
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="waffle.html"
            >Waffle section</a
          >
          <a
            class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger"
            href="https://www.data-to-viz.com"
            >Data to Viz</a
          >
        </div>
      </div>
    </header>

    <!-- THIS ALLOWS TO INSERT THE ADVERTISEMENT BANNER THAT IS STORED IN A BANNER.HTML FILE-->
    <div id="position_for_images"></div>
    <script>
      $(function () {
        $("#position_for_images").load("html_chunk/images.html");
      });
    </script>

    <!-- STYLE for chart pages but not the rest of tthe website -->
    <style>
      img {
        margin-top: 20px;
      }
    </style>

    <div class="container" style="padding-top: 100px">
      <div id="about" class="section level1">
        <h1>About</h1>
        <hr />
        <p>
          This chart, and its step-by-step guide, has been realised by
          <a href="https://twitter.com/BjnNowak">Benjamin Nowak</a>. Thanks to
          him for sharing this content!
        </p>
        <p>
          As a <strong>teaser</strong>, here is the chart we are going to build:
        </p>
        <div style="text-align: center">
          <p>
            <img
              src="img/graph/web-waffle-chart-for-distribution.png"
              alt="Waffle Chart"
              style="width: 100%; max-width: 600px; height: auto"
            />
          </p>
        </div>
      </div>
      <div id="load-packages-and-data" class="section level1">
        <h1>Load packages and data</h1>
        <hr />
        <p>
          In R, waffle charts may be created with the
          <a href="waffle.html">{waffle}</a> package. In addition to this
          library, we will load several packages that we will need for this
          tutorial:
        </p>
        <div class="sourceCode" id="cb1">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(waffle)   </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(sf)        </span></code></pre>
        </div>
        <p>
          But what data are we going to represent? End of suspense, the graph
          shows <strong>average national wheat and corn yields</strong> for the
          period 2010 to 2020. These data have been downloaded from
          <strong>FAOSTAT</strong>.
        </p>
        <div class="sourceCode" id="cb2">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/BjnNowak/book/main/data/wheat_maize_2010_2020.csv&#39;</span>)     </span></code></pre>
        </div>
      </div>
      <div id="compute-mean-yields-for-the-period" class="section level1">
        <h1>Compute mean yields for the period</h1>
        <hr />
        <p>
          The great advantage of <strong>FAOSTAT data tables</strong> is that
          they are always formatted in the same way. So, once you‚Äôre used to
          them, it‚Äôs easy to find your way around. What‚Äôs more, these tables are
          in <strong>long format</strong>, making them easy to process with the
          tidyverse.
        </p>
        <p>About the columns we‚Äôll be using here:</p>
        <ul>
          <li>
            <p>
              the country code is stored in the
              <code>Area Code (M49)</code> column
            </p>
          </li>
          <li>
            <p>
              the <code>Item</code> column indicates the
              <strong>type of crop</strong> (wheat or maize here)
            </p>
          </li>
          <li>
            <p>
              the <code>Value</code> column gives the
              <strong>value of the variable of interest</strong> (here, yield)
            </p>
          </li>
        </ul>
        <p>
          The average yield over the period is therefore calculated as follows:
        </p>
        <div class="sourceCode" id="cb3">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>clean<span class="ot">&lt;-</span>data<span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">M49 =</span> <span class="st">&#39;Area Code (M49)&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">drop_na</span>(Value)<span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">group_by</span>(M49, Item)<span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">yield=</span><span class="fu">mean</span>(Value)<span class="sc">/</span><span class="dv">10000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre>
        </div>
        <p>
          We‚Äôre now going to
          <strong>assign a continent to each country</strong>. To do this, we‚Äôll
          use the world map available in the
          <code>{rnaturalearth}</code> package, keeping only the attribute table
          and ignoring the geometry.
        </p>
        <p>
          The join will be based on the
          <strong>United Nations codes</strong> (column <code>M49</code> in our
          data table, column <code>un_a3</code> in the
          <code>{rnaturalearth}</code> table).
        </p>
        <div class="sourceCode" id="cb4">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>wrld <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">type =</span> <span class="st">&quot;countries&quot;</span>, <span class="at">scale =</span> <span class="st">&quot;small&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>clean <span class="ot">&lt;-</span> clean<span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">left_join</span>(wrld,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;M49&#39;</span><span class="ot">=</span><span class="st">&#39;un_a3&#39;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">select</span>(M49,Item,yield,continent)<span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="fu">drop_na</span>(continent)</span></code></pre>
        </div>
      </div>
      <div id="make-waffle-chart-for-wheat" class="section level1">
        <h1>Make waffle chart for wheat</h1>
        <hr />
        <p>
          To create our waffle charts, we need to (i)
          <strong>create yield classes</strong> and (ii) count the
          <strong>number of countries</strong> in each class (with a different
          count for each continent).
        </p>
        <p>This is done as follows:</p>
        <div class="sourceCode" id="cb5">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>clean <span class="ot">&lt;-</span> clean <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="at">rd=</span><span class="fu">floor</span>(yield),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="at">ct=</span><span class="dv">1</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">group_by</span>(rd, Item, continent)<span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="at">n=</span><span class="fu">sum</span>(ct)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre>
        </div>
        <p>
          We‚Äôre now ready to create our first distribution curve plotted as a
          waffle chart! But to make things easier, we‚Äôll start with
          <strong>wheat only</strong>.
        </p>
        <p>
          With <code>{waffle}</code>, waffle charts are created with
          <code>geom_waffle()</code>.
        </p>
        <p>
          With this function, there‚Äôs one important thing to know: the yield
          classes here must be
          <strong>added as successive graphs</strong> (facets), not simply as
          classes on the x-axis.
        </p>
        <div class="sourceCode" id="cb6">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    <span class="co"># Keep only data for wheat</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    clean<span class="sc">%&gt;%</span><span class="fu">filter</span>(Item<span class="sc">==</span><span class="st">&quot;Wheat&quot;</span>),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">values=</span>n, <span class="at">fill=</span>continent)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  waffle<span class="sc">::</span><span class="fu">geom_waffle</span>(</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="at">n_rows =</span> <span class="dv">4</span>,        <span class="co"># Number of squares in each row</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,   <span class="co"># Border color</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    <span class="at">flip =</span> <span class="cn">TRUE</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>rd)<span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre>
        </div>
        <p>
          <img
            src="web-waffle-chart-for-distribution_files/figure-html/unnamed-chunk-6-1.png"
            width="960"
            style="display: block; margin: auto"
          />
        </p>
        <p>
          Note that the x-axis and y-axis values don‚Äôt correspond to anything
          significant here (<strong>we‚Äôll remove them later</strong>). Only the
          facet titles are important (0 for countries with yields from 0 to 1
          ton, etc.).
        </p>
      </div>
      <div id="make-waffle-chart-for-both-crops" class="section level1">
        <h1>Make waffle chart for both crops</h1>
        <hr />
        <p>
          We‚Äôre now going to present the values
          <strong>for the two crops</strong>, wheat and maize, simultaneously
          but <strong>keeping only the yields below 10 tons</strong>.
        </p>
        <div class="sourceCode" id="cb7">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    clean<span class="sc">%&gt;%</span><span class="fu">filter</span>(rd<span class="sc">&lt;</span><span class="dv">10</span>),</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">values=</span>n, <span class="at">fill=</span>continent)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  waffle<span class="sc">::</span><span class="fu">geom_waffle</span>(</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="at">n_rows =</span> <span class="dv">4</span>,        <span class="co"># Number of squares in each row</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,   <span class="co"># Border color</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="at">flip =</span> <span class="cn">TRUE</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  <span class="co"># Add Item in facet_grid</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Item<span class="sc">~</span>rd)<span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre>
        </div>
        <p>
          <img
            src="web-waffle-chart-for-distribution_files/figure-html/unnamed-chunk-7-1.png"
            width="960"
            style="display: block; margin: auto"
          />
        </p>
        <p>
          If you try to remove the filter on the yield, you‚Äôll see that R
          returns an <strong>error message</strong>. What‚Äôs the problem?
          Because, unlike corn, wheat doesn‚Äôt have a country with a mean yield
          above 10 tons. The corresponding facets cannot be represented with
          <code>ggplot()</code>.
        </p>
        <p>
          The workaround? Create an <strong>imaginary continent</strong> that
          can be present for all combinations, but which we‚Äôll then make
          disappear in the color palettes!
        </p>
        <p>This is how we will proceed:</p>
        <div class="sourceCode" id="cb8">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>cpl<span class="ot">&lt;-</span>clean<span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="co"># Removing some countries with unrealistic yield for maize</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">filter</span>(rd<span class="sc">&lt;</span><span class="dv">14</span>)<span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="co"># Complete all combinations for real continents, but with 0 value </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="co"># (this prevents cases from being created during the 2nd application of the function)</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    rd,Item,continent, </span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    <span class="at">fill=</span><span class="fu">list</span>(<span class="at">n=</span><span class="dv">0</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  )<span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  <span class="co"># Add imaginary &#39;z&#39; continent</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">continent=</span><span class="st">&#39;z&#39;</span>,<span class="at">Item=</span><span class="st">&#39;Wheat&#39;</span>,<span class="at">n=</span><span class="dv">0</span>,<span class="at">rd=</span><span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="co"># Complete all combination for the &#39;z&#39; continente</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    rd,Item,continent, </span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>    <span class="at">fill=</span><span class="fu">list</span>(<span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  )</span></code></pre>
        </div>
        <p>We can now plot the data without filter.</p>
        <div class="sourceCode" id="cb9">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    cpl, <span class="co"># Use cpl (complete) tibble </span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">values=</span>n, <span class="at">fill=</span>continent)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  waffle<span class="sc">::</span><span class="fu">geom_waffle</span>(</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="at">n_rows =</span> <span class="dv">4</span>,              <span class="co"># Number of squares in each row</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,         <span class="co"># Border color</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="at">flip =</span> <span class="cn">TRUE</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="co"># Add Item in facet_grid</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Item<span class="sc">~</span>rd)<span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre>
        </div>
        <p>
          <img
            src="web-waffle-chart-for-distribution_files/figure-html/unnamed-chunk-9-1.png"
            width="960"
            style="display: block; margin: auto"
          />
        </p>
      </div>
      <div id="plot-customization" class="section level1">
        <h1>Plot customization</h1>
        <hr />
        <p>
          We now have some work to do to customize the graph ! First thing:
          create <strong>two color palette</strong> (one for fill, one for
          borders) to hide the imaginary z continent.
        </p>
        <p>
          Here‚Äôs the palette color I use for each continent in my book. Using
          the same color for a given continent throughout the book makes it
          <strong>easier to read</strong>.
        </p>
        <div class="sourceCode" id="cb10">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="st">&quot;Africa&quot;</span> <span class="ot">=</span> <span class="st">&quot;#FFC43D&quot;</span>, <span class="st">&quot;Asia&quot;</span> <span class="ot">=</span> <span class="st">&quot;#F0426B&quot;</span>, <span class="st">&quot;Europe&quot;</span> <span class="ot">=</span> <span class="st">&quot;#5A4FCF&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="st">&quot;South America&quot;</span> <span class="ot">=</span> <span class="st">&quot;#06D6A0&quot;</span>, <span class="st">&quot;North America&quot;</span> <span class="ot">=</span> <span class="st">&quot;#059E75&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="st">&quot;Oceania&quot;</span> <span class="ot">=</span> <span class="st">&quot;#F68EA6&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="co"># Set alpha to 0 to hide &#39;z&#39;</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="st">&#39;z&#39;</span><span class="ot">=</span><span class="fu">alpha</span>(<span class="st">&#39;white&#39;</span>,<span class="dv">0</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>pal_color <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>  <span class="st">&quot;Africa&quot;</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>, <span class="st">&quot;Asia&quot;</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>, <span class="st">&quot;Europe&quot;</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>  <span class="st">&quot;South America&quot;</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>, <span class="st">&quot;North America&quot;</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>  <span class="st">&quot;Oceania&quot;</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>  <span class="co"># Set alpha to 0 to hide &#39;z&#39;</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  <span class="st">&#39;z&#39;</span><span class="ot">=</span><span class="fu">alpha</span>(<span class="st">&#39;white&#39;</span>,<span class="dv">0</span>)</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>)</span></code></pre>
        </div>
        <p>
          It also seems more natural to place corn at the bottom (as it has more
          yield classes). We‚Äôll do this by
          <strong>reordering the factors</strong>:
        </p>
        <div class="sourceCode" id="cb11">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Order crop names</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>cpl<span class="sc">$</span>Item <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(cpl<span class="sc">$</span>Item)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>cpl<span class="sc">$</span>Item <span class="ot">&lt;-</span> <span class="fu">fct_relevel</span>(cpl<span class="sc">$</span>Item, <span class="st">&quot;Wheat&quot;</span>,<span class="st">&quot;Maize (corn)&quot;</span>)</span></code></pre>
        </div>
        <p>Let‚Äôs go for a new version of the plot:</p>
        <div class="sourceCode" id="cb12">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  cpl,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">values=</span>n,<span class="at">fill=</span>continent,<span class="at">color=</span>continent)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  waffle<span class="sc">::</span><span class="fu">geom_waffle</span>(</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="at">n_rows =</span> <span class="dv">3</span>, </span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    <span class="at">flip =</span> <span class="cn">TRUE</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    Item<span class="sc">~</span>rd, </span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    <span class="at">switch=</span><span class="st">&quot;both&quot;</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>()<span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>pal_fill)<span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>pal_color)<span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>p1</span></code></pre>
        </div>
        <p>
          <img
            src="web-waffle-chart-for-distribution_files/figure-html/unnamed-chunk-12-1.png"
            width="960"
            style="display: block; margin: auto"
          />
        </p>
        <p>
          We are now going to place the <strong>legend in the subtitle</strong>
          (with each continent name colored accordingly), using
          <code>{ggtext}</code> syntax:
        </p>
        <div class="sourceCode" id="cb13">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>title<span class="ot">&lt;-</span><span class="st">&quot;&lt;b&gt;The Yield Gap&lt;/b&gt;&quot;</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>sub<span class="ot">&lt;-</span><span class="st">&quot;Each square is a country, colored according to continent:&lt;br&gt;&lt;b&gt;&lt;span style=&#39;color:#FFC43D;&#39;&gt;Africa&lt;/span&gt;&lt;/b&gt;, &lt;b&gt;&lt;span style=&#39;color:#F0426B;&#39;&gt;Asia&lt;/span&gt;&lt;/b&gt;, &lt;b&gt;&lt;span style=&#39;color:#5A4FCF;&#39;&gt;Europe&lt;/span&gt;&lt;/b&gt;, &lt;b&gt;&lt;span style=&#39;color:#059E75;&#39;&gt;Central and North America&lt;/span&gt;&lt;/b&gt;, &lt;b&gt;&lt;span style=&#39;color:#06D6A0;&#39;&gt;South America&lt;/span&gt;&lt;/b&gt; or &lt;b&gt;&lt;span style=&#39;color:#F68EA6;&#39;&gt;Oceania&lt;/span&gt;. &quot;</span></span></code></pre>
        </div>
        <p>We may now add these labels to our plot:</p>
        <div class="sourceCode" id="cb14">
          <pre
            class="sourceCode r"
          ><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>p2<span class="ot">&lt;-</span>p1<span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="co"># Hide legend</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="st">&#39;none&#39;</span>,<span class="at">color=</span><span class="st">&#39;none&#39;</span>)<span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="co"># Add title and subtitle</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span>title,<span class="at">subtitle=</span>sub)<span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    <span class="co"># Enable markdown for title and subtitle</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    <span class="at">plot.title=</span><span class="fu">element_markdown</span>(),</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>    <span class="at">plot.subtitle=</span><span class="fu">element_markdown</span>(),</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    <span class="co"># &quot;Clean&quot; facets </span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>    <span class="at">panel.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>    <span class="at">strip.background.x =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>    <span class="at">strip.background.y =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;dimgrey&quot;</span>),</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;white&quot;</span>)</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>  )</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;img/graph/web-waffle-chart-for-distribution.png&quot;</span>,p2)</span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>p2</span></code></pre>
        </div>
        <p>
          <img
            src="web-waffle-chart-for-distribution_files/figure-html/unnamed-chunk-14-1.png"
            width="960"
            style="display: block; margin: auto"
          />
        </p>
        <p>Here‚Äôs a relatively clean version of the chart!</p>
        <p>What can we see here?</p>
        <ul>
          <li>
            <p>
              For both crops, the distribution curves are
              <strong>centered</strong> on low yields
            </p>
          </li>
          <li>
            <p>
              A majority of African countries show low to
              <strong>very low yields</strong>
            </p>
          </li>
        </ul>
        <p>
          In this way, major improvements in food production could be achieved
          by improving yields in the least efficient countries (by moving
          towards a ‚ÄúGaussian‚Äù distribution) rather than by gaining a few
          percentages of production in already efficient countries. This is all
          the more true given that the higher the yields, the greater the
          quantity of inputs needed to further increase productivity (and
          therefore the lower the efficiency of these inputs).
        </p>
      </div>
      <div id="going-further" class="section level1">
        <h1>Going further</h1>
        <hr />
        <p>
          This post explains how to create a
          <a href="waffle.html">waffle chart</a> as a distribution curve for two
          crops.
        </p>
        <p>
          If you want to learn more, you can check the
          <a href="waffle.html">waffle section</a> of the gallery and
          <a href="407-geom-waffle-multiple-groups.html"
            >how to play with subgroups and colors</a
          >
          in waffle charts.
        </p>
        <!-- Close container -->
      </div>
    </div>
    <!-- ============================ RELATED SECTION ============================ -->
    <section
      class="bg-light"
      id="portfolio_landing"
      style="padding-top: 30px; padding-bottom: 30px; margin-top: 100px"
    >
      <div class="container">
        <p class="mySeryTitle">Related chart types</p>
        <hr />
        <div class="row">
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="barplot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/section/Bar150.png" alt="" />
            </a>
            <div class="captionPortfolio">Barplot</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="spider-or-radar-chart.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/section/Spider150.png" alt="" />
            </a>
            <div class="captionPortfolio">Spider / Radar</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="wordcloud.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img
                class="img-fluid"
                src="img/section/Wordcloud150.png"
                alt=""
              />
            </a>
            <div class="captionPortfolio">Wordcloud</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="parallel-plot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img
                class="img-fluid"
                src="img/section/Parallel1150.png"
                alt=""
              />
            </a>
            <div class="captionPortfolio">Parallel</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="lollipop-plot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/section/Lollipop150.png" alt="" />
            </a>
            <div class="captionPortfolio">Lollipop</div>
          </div>
          <div class="col-md-2 col-sm-4 portfolio-item">
            <a class="portfolio-link" href="circular-barplot.html">
              <div class="portfolio-hover">
                <div class="portfolio-hover-content">
                  <i class="fa fa-plus fa-3x"></i>
                </div>
              </div>
              <img
                class="img-fluid"
                src="img/section/CircularBarplot150.png"
                alt=""
              />
            </a>
            <div class="captionPortfolio">Circular Barplot</div>
          </div>
        </div>
      </div>
    </section>
    <!-- ============================ CONTACT SECTION ============================ -->
    <section
      id="contact"
      class="bg"
      style="background-color: white; padding-top: 60px"
    >
      <div class="container">
        <div class="row">
          <div class="col-lg-2 text-center"></div>
          <div class="col-lg-8 text-center">
            <br /><br /><br />
            <h2>‚ù§Ô∏è 10 best R tricks ‚ù§Ô∏è</h2>
            <p style="max-width: 620px; text-align: center">
              üëã After crafting hundreds of R charts over 12 years, I've
              distilled my top 10 tips and tricks. Receive them via email!
              <b>One insight per day for the next 10 days</b>! üî•
            </p>
            <div style="display: flex; justify-content: center">
              <script
                async
                data-uid="329fda5a7e"
                src="https://prodigious-trailblazer-3628.ck.page/329fda5a7e/index.js"
              ></script>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============================ FOOTER SECTION ============================ -->

    <!-- AdThrive Footer Code Start-->
    <script
      type="text/javascript"
      async
      src="https://btloader.com/tag?o=5698917485248512&upapi=true&domain=r-graph-gallery.com"
    ></script>
    <script>
      !(function () {
        "use strict";
        var e;
        (e = document),
          (function () {
            var t, n;
            function r() {
              var t = e.createElement("script");
              (t.src =
                "https://cafemedia-com.videoplayerhub.com/galleryplayer.js"),
                e.head.appendChild(t);
            }
            function a() {
              var t = e.cookie.match("(^|[^;]+)\s*__adblocker\s*=\s*([^;]+)");
              return t && t.pop();
            }
            function c() {
              clearInterval(n);
            }
            return {
              init: function () {
                var e;
                "true" === (t = a())
                  ? r()
                  : ((e = 0),
                    (n = setInterval(function () {
                      (100 !== e && "false" !== t) || c(),
                        "true" === t && (r(), c()),
                        (t = a()),
                        e++;
                    }, 50)));
              },
            };
          })().init();
      })();
    </script>
    <!-- AdThrive Footer Code End -->

    <footer class="bg-light" id="myFooter">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <span class="copyright"
              >Copyright &copy; the R graph gallery 2025</span
            >
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a href="https://twitter.com/R_Graph_Gallery">
                  <i class="fa fa-twitter"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/holtzy">
                  <i class="fa fa-github"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                  <i class="fa fa-linkedin"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a href="#">Privacy Policy</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Terms of Use</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // add bootstrap table styles to pandoc tables
      function bootstrapStylePandocTables() {
        $("tr.header")
          .parent("thead")
          .parent("table")
          .addClass("table table-condensed");
      }
      $(document).ready(function () {
        bootstrapStylePandocTables();
      });
    </script>

    <!-- ============================ JAVASCRIPT SECTION ============================ -->

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>
  </body>
</html>
